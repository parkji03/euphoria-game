var MOB={gumballMachines:null,gummyBears:null,createGummyBear:function(e,t,l,a,i,o,r,n,u){var c=i.create(t,l,a);c.scale.setTo(WORLD.scale),e.physics.arcade.enable(c),c.body.collisionWorldBounds=!0,c.body.bounce.set(1),c.body.gravity.set(0,-1e3),c.anchor.setTo(.5),c.cloudCollide=u,u||(c.body.bounce.set(.7),c.checkWorldBounds=!0,c.events.onOutOfBounds.add(function(){c.moveDirection*=-1,c.scale.x*=-1;var e=getRandomInt(1,5);1===e?c.loadTexture("red_gummy_bear",0):2===e?c.loadTexture("blue_gummy_bear",0):3===e?c.loadTexture("green_gummy_bear",0):4===e?c.loadTexture("yellow_gummy_bear",0):5===e&&c.loadTexture("orange_gummy_bear",0),c.reset(getRandomInt(t-100,t+100),0)},e));var s=Math.floor(2*Math.random());c.rotationDirection=1==s?1:-1,c.rotationLimit=12,1==Math.floor(2*Math.random())?(c.moveDirection=1,c.scale.x*=-1):c.moveDirection=-1,c.initMoveSpeed=100,c.moveSpeed=100,c.isMoving=o,o||c.body.bounce.set(0),"left"===r?c.scale.setTo(WORLD.scale):"right"===r&&c.scale.setTo(-WORLD.scale,WORLD.scale),n&&(c.dropTrigger=!0,c.initFireRate=800,c.fireRate=1500,c.nextFire=0,c.bullets=this.createGummyBearBullets(e,a,!0))},createGummyBearBullets:function(e,t,l){var a=e.add.group();return a.enableBody=!0,a.physicsBodyType=Phaser.Physics.ARCADE,"red_gummy_bear"===t?a.createMultiple(50,"red_gumball"):"green_gummy_bear"===t?a.createMultiple(50,"green_gumball"):"yellow_gummy_bear"===t?a.createMultiple(50,"yellow_gumball"):"orange_gummy_bear"===t?a.createMultiple(50,"orange_gumball"):"blue_gummy_bear"===t&&a.createMultiple(50,"blue_gumball"),a.setAll("checkWorldBounds",!0),a.setAll("outOfBoundsKill",!0),l||a.setAll("body.allowGravity",!1),a},updateGummyBearMovement:function(e){e.physics.arcade.collide(this.gummyBears,WORLD.worldLayer),e.physics.arcade.overlap(PLAYER.sprite,this.gummyBears,function(){PLAYER.death(e)},null,e),this.gummyBears.forEach(function(t){if(t.cloudCollide){e.physics.arcade.collide(t,WORLD.clouds,function(e,t){e.body.touching.down&&(e.body.position.x=e.body.position.x+t.deltaX,e.body.position.y=e.body.position.y+t.deltaY)})}if(t.isMoving&&(t.angle>t.rotationLimit?t.rotationDirection=-1:t.angle<-t.rotationLimit&&(t.rotationDirection=1),t.angle+=.5*t.rotationDirection,e.physics.arcade.collide(MOB.gummyBears,WORLD.mobBlockLayer)&&(t.moveDirection*=-1,t.scale.x*=-1),t.moveSpeed=t.initMoveSpeed+100*(1-UI.happyBarPercent),t.body.velocity.x=t.moveDirection*t.moveSpeed),t.dropTrigger&&(t.fireRate=t.initFireRate-(1-UI.happyBarPercent)*(t.initFireRate/2),e.time.now>t.nextFire&&t.bullets.countDead()>0)){t.nextFire=e.time.now+t.fireRate;t.bullets.getFirstDead().reset(t.position.x,t.position.y+10)}e.physics.arcade.collide(t.bullets,WORLD.worldLayer,function(e){e.kill()}),e.physics.arcade.overlap(PLAYER.sprite,t.bullets,function(t,l){PLAYER.alive&&l.kill(),PLAYER.death(e)},null,e)},e)},createGumballMachine:function(e,t,l,a,i,o){var r=a.create(t,l,"gumball_machine");return r.triggered=!1,r.anchor.setTo(.5),r.initSpeed=8,r.shootDirection=i,"left"===i?r.scale.setTo(1.45):r.scale.setTo(-1.45,1.45),e.physics.arcade.enable(r),r.animations.add("shoot",[0,1,1,2,2,3,0,0,0],4,!0).speed=r.initSpeed,r.initFireRate=3e3,r.initBulletSpeed=200,r.fireRate=3e3,r.nextFire=0,r.bulletSpeed=200,r.bullets=this.createGumballMachineBullets(e),r.randomize=o,r},createGumballMachineBullets:function(e){var t=e.add.group();t.enableBody=!0,t.physicsBodyType=Phaser.Physics.ARCADE;for(var l=0;l<20;l++){var a=getRandomInt(1,3);1===a?(t.createMultiple(1,"red_gumball"),t.createMultiple(1,"blue_gumball"),t.createMultiple(1,"yellow_gumball")):2===a?(t.createMultiple(1,"blue_gumball"),t.createMultiple(1,"orange_gumball"),t.createMultiple(1,"green_gumball")):3===a&&(t.createMultiple(1,"green_gumball"),t.createMultiple(1,"red_gumball"),t.createMultiple(1,"blue_gumball"))}return t.setAll("checkWorldBounds",!0),t.setAll("outOfBoundsKill",!0),t.setAll("body.allowGravity",!1),t},updateGumballMachineMovement:function(e){e.physics.arcade.collide(this.gumballMachines,WORLD.worldLayer),MOB.gumballMachines.forEach(function(t){if(t.triggered&&(t.animations.play("shoot").speed=t.initSpeed+10*(1-UI.happyBarPercent),t.bulletSpeed=t.initBulletSpeed+70*(1-UI.happyBarPercent),t.fireRate=t.initFireRate-1700*(1-UI.happyBarPercent),e.time.now>t.nextFire&&t.bullets.countDead()>0)){t.nextFire=e.time.now+t.fireRate,t.randomize&&(t.nextFire=e.time.now+getRandomInt(950,1250));var l=t.bullets.getFirstDead();"left"===t.shootDirection?(l.reset(t.position.x-13,t.position.y+10),l.body.velocity.x=-1*t.bulletSpeed):(l.reset(t.position.x+10,t.position.y+10),l.body.velocity.x=t.bulletSpeed)}e.physics.arcade.collide(t.bullets,WORLD.worldLayer,function(e){e.kill()}),e.physics.arcade.overlap(PLAYER.sprite,t.bullets,function(t,l){PLAYER.alive&&l.kill(),PLAYER.death(e)},null,e)},e)},create:function(){},update:function(e){this.updateGumballMachineMovement(e),this.updateGummyBearMovement(e)}};